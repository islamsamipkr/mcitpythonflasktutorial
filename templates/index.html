<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>QuickBite — Food Delivery Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col">

  <!-- Top Navbar -->
  <header class="border-b border-slate-800 bg-slate-950/80 backdrop-blur sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <div class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-lg bg-gradient-to-tr from-orange-500 to-pink-500 flex items-center justify-center text-xs font-bold">
          QB
        </div>
        <div>
          <p class="text-sm font-semibold">QuickBite</p>
          <p class="text-[11px] text-slate-400">Food Delivery • Demo</p>
        </div>
      </div>
      <div class="ml-auto flex items-center gap-3 text-xs text-slate-400">
        <span class="hidden sm:inline">Delivery location: <span class="text-slate-200">Montreal, QC</span></span>
        <span class="px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300 border border-emerald-500/40 text-[11px]">
          Demo only – no real orders
        </span>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <main class="flex-1 max-w-6xl mx-auto w-full px-4 py-4 flex flex-col lg:flex-row gap-6">

    <!-- Left: Menu & Hero -->
    <section class="flex-1 flex flex-col gap-4">
      <!-- Hero / search / filters -->
      <div class="bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 rounded-2xl p-4 shadow-lg">
        <div class="flex flex-col md:flex-row gap-4 items-start md:items-center">
          <div class="flex-1">
            <h1 class="text-2xl md:text-3xl font-bold mb-1">
              Craving something delicious?
            </h1>
            <p class="text-sm text-slate-400 mb-3">
              Browse popular dishes, add to cart and place a demo order.
            </p>

            <div class="flex gap-2 items-center">
              <div class="hidden sm:flex -space-x-2">
                <div class="h-6 w-6 rounded-full bg-orange-500/80 border border-slate-900"></div>
                <div class="h-6 w-6 rounded-full bg-purple-500/80 border border-slate-900"></div>
                <div class="h-6 w-6 rounded-full bg-emerald-500/80 border border-slate-900"></div>
              </div>
              <p class="text-[11px] text-slate-400">
                <span class="text-emerald-400 font-semibold">Fast</span> •
                <span class="text-orange-300 font-semibold">Fresh</span> •
                <span class="text-sky-300 font-semibold">Just a demo</span>
              </p>
            </div>
          </div>

          <div class="w-full md:w-72">
            <div class="flex items-center gap-2 bg-slate-900/80 border border-slate-700 rounded-xl px-3 py-2">
              <input
                id="searchInput"
                type="text"
                placeholder="Search pizza, burgers, etc..."
                class="bg-transparent flex-1 text-sm outline-none placeholder:text-slate-500"
              />
              <button
                class="text-xs px-2 py-1 rounded-lg bg-slate-800 border border-slate-600 text-slate-300"
                onclick="clearSearch()"
              >
                Clear
              </button>
            </div>

            <div class="flex flex-wrap gap-2 mt-3 text-xs">
              <button class="filter-pill" data-category="All">All</button>
              <button class="filter-pill" data-category="Pizza">Pizza</button>
              <button class="filter-pill" data-category="Indian">Indian</button>
              <button class="filter-pill" data-category="Burgers">Burgers</button>
              <button class="filter-pill" data-category="Salads">Salads</button>
              <button class="filter-pill" data-category="Desserts">Desserts</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Menu grid -->
      <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-4 shadow-inner">
        <div class="flex items-center mb-3">
          <h2 class="text-sm font-semibold text-slate-200">Menu</h2>
          <span id="menuCount" class="ml-2 text-[11px] text-slate-500"></span>
        </div>
        <div id="menuGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3">
          <!-- Filled by JS -->
        </div>
      </div>
    </section>

    <!-- Right: Cart & Checkout -->
    <aside class="w-full lg:w-80 flex flex-col gap-4">

      <!-- Alerts -->
      <section id="alertBox" class="hidden">
        <div id="alertContent" class="rounded-xl px-4 py-3 text-sm border"></div>
      </section>

      <!-- Cart -->
      <section class="bg-slate-950/80 border border-slate-800 rounded-2xl p-4 shadow-lg flex flex-col gap-3">
        <div class="flex items-center">
          <h2 class="text-sm font-semibold">Your Cart</h2>
          <span id="cartBadge" class="ml-2 text-[11px] text-slate-500">(0 items)</span>
          <button
            class="ml-auto text-[11px] text-slate-400 hover:text-slate-200 underline"
            onclick="clearCart()"
          >
            Clear
          </button>
        </div>

        <div id="cartEmpty" class="text-xs text-slate-500 italic">
          Your cart is empty. Add some delicious items!
        </div>

        <div id="cartList" class="space-y-2 text-sm max-h-64 overflow-auto hidden">
          <!-- Filled by JS -->
        </div>

        <div class="border-t border-slate-800 pt-3 mt-1 text-sm">
          <div class="flex justify-between items-center mb-1">
            <span class="text-slate-400">Subtotal</span>
            <span id="cartSubtotal" class="font-semibold">$0.00</span>
          </div>
          <div class="flex justify-between items-center mb-1 text-[11px] text-slate-500">
            <span>Service fee</span>
            <span>$0.00 (demo)</span>
          </div>
          <div class="flex justify-between items-center mt-1">
            <span class="text-xs text-slate-400">Estimated total</span>
            <span id="cartTotal" class="text-lg font-bold text-emerald-400">$0.00</span>
          </div>
        </div>
      </section>

      <!-- Checkout -->
      <section class="bg-slate-950/80 border border-slate-800 rounded-2xl p-4 shadow-lg">
        <h2 class="text-sm font-semibold mb-2">Delivery Details</h2>
        <div class="space-y-2 text-sm">
          <div>
            <label class="block text-xs text-slate-400 mb-1">Name</label>
            <input
              id="customerName"
              type="text"
              class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-slate-100 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400"
              placeholder="Your name"
            />
          </div>
          <div>
            <label class="block text-xs text-slate-400 mb-1">Address</label>
            <textarea
              id="customerAddress"
              rows="2"
              class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-slate-100 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400"
              placeholder="Street, city, postal code"
            ></textarea>
          </div>
          <div>
            <label class="block text-xs text-slate-400 mb-1">Phone</label>
            <input
              id="customerPhone"
              type="text"
              class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-slate-100 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400"
              placeholder="Contact number"
            />
          </div>
          <div>
            <label class="block text-xs text-slate-400 mb-1">Delivery notes (optional)</label>
            <input
              id="customerNotes"
              type="text"
              class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-slate-100 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400"
              placeholder="e.g. buzzer code, no bell, etc."
            />
          </div>

          <button
            id="placeOrderBtn"
            class="w-full mt-2 px-4 py-2 rounded-lg bg-emerald-500 text-slate-900 font-semibold text-sm hover:bg-emerald-400 transition disabled:opacity-40 disabled:cursor-not-allowed"
            onclick="placeOrder()"
          >
            Place Demo Order
          </button>

          <p class="text-[11px] text-slate-500 mt-1">
            This is a <span class="text-emerald-300 font-semibold">demo</span>.
            No real payments, no real deliveries.
          </p>
        </div>
      </section>
    </aside>
  </main>

  <script>
    let fullMenu = [];
    let filteredMenu = [];
    let cart = [];

    function showAlert(message, type = "info") {
      const box = document.getElementById("alertBox");
      const content = document.getElementById("alertContent");
      const base = "text-sm px-4 py-3 border rounded-xl";

      if (type === "error") {
        content.className = base + " bg-rose-950/70 border-rose-500/60 text-rose-200";
      } else if (type === "success") {
        content.className = base + " bg-emerald-950/70 border-emerald-500/60 text-emerald-200";
      } else {
        content.className = base + " bg-slate-900 border-slate-600 text-slate-200";
      }
      content.textContent = message;
      box.classList.remove("hidden");
      setTimeout(() => box.classList.add("hidden"), 3500);
    }

    function formatPrice(n) {
      return "$" + n.toFixed(2);
    }

    function renderMenu() {
      const grid = document.getElementById("menuGrid");
      const countLabel = document.getElementById("menuCount");
      grid.innerHTML = "";

      filteredMenu.forEach(item => {
        const card = document.createElement("div");
        card.className =
          "bg-slate-900/70 border border-slate-800 rounded-xl p-3 flex flex-col gap-2 hover:border-emerald-500/40 hover:shadow-lg transition";

        card.innerHTML = `
          <div class="flex justify-between gap-2">
            <div>
              <p class="text-sm font-semibold">${item.name}</p>
              <p class="text-[11px] text-slate-400">${item.description}</p>
              <div class="mt-1 flex items-center gap-2">
                <span class="text-xs px-2 py-0.5 rounded-full bg-slate-800 text-slate-300 border border-slate-700">
                  ${item.category}
                </span>
              </div>
            </div>
            <div class="flex flex-col items-end justify-between">
              <p class="text-base font-bold text-emerald-400">${formatPrice(item.price)}</p>
              <button
                class="mt-2 text-xs px-3 py-1 rounded-lg bg-emerald-500 text-slate-950 font-semibold hover:bg-emerald-400"
                onclick="addToCart(${item.id})"
              >
                Add
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });

      countLabel.textContent = `(${filteredMenu.length} items)`;
    }

    function applyFilters() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase().trim();
      const activeCategory = document.querySelector(".filter-pill-active")?.dataset.category || "All";

      filteredMenu = fullMenu.filter(item => {
        const matchCategory =
          activeCategory === "All" || item.category.toLowerCase() === activeCategory.toLowerCase();
        const matchSearch =
          !searchValue ||
          item.name.toLowerCase().includes(searchValue) ||
          item.description.toLowerCase().includes(searchValue) ||
          item.category.toLowerCase().includes(searchValue);

        return matchCategory && matchSearch;
      });

      renderMenu();
    }

    function clearSearch() {
      document.getElementById("searchInput").value = "";
      applyFilters();
    }

    function addToCart(id) {
      const existing = cart.find(item => item.id === id);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ id, quantity: 1 });
      }
      renderCart();
      showAlert("Added to cart.", "success");
    }

    function removeFromCart(id) {
      cart = cart.filter(item => item.id !== id);
      renderCart();
    }

    function updateCartQuantity(id, delta) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.quantity += delta;
      if (item.quantity <= 0) {
        removeFromCart(id);
      } else {
        renderCart();
      }
    }

    function clearCart() {
      cart = [];
      renderCart();
    }

    function getMenuItem(id) {
      return fullMenu.find(i => i.id === id);
    }

    function renderCart() {
      const list = document.getElementById("cartList");
      const badge = document.getElementById("cartBadge");
      const emptyMsg = document.getElementById("cartEmpty");
      const subtotalEl = document.getElementById("cartSubtotal");
      const totalEl = document.getElementById("cartTotal");

      list.innerHTML = "";

      if (!cart.length) {
        badge.textContent = "(0 items)";
        emptyMsg.classList.remove("hidden");
        list.classList.add("hidden");
        subtotalEl.textContent = "$0.00";
        totalEl.textContent = "$0.00";
        return;
      }

      emptyMsg.classList.add("hidden");
      list.classList.remove("hidden");

      let itemCount = 0;
      let subtotal = 0;

      cart.forEach(ci => {
        const menuItem = getMenuItem(ci.id);
        if (!menuItem) return;

        const lineTotal = menuItem.price * ci.quantity;
        subtotal += lineTotal;
        itemCount += ci.quantity;

        const row = document.createElement("div");
        row.className = "flex items-center justify-between gap-2 border-b border-slate-800/80 pb-2 last:border-0";
        row.innerHTML = `
          <div class="flex-1">
            <p class="text-xs font-semibold">${menuItem.name}</p>
            <p class="text-[11px] text-slate-500">${formatPrice(menuItem.price)} • ${menuItem.category}</p>
          </div>
          <div class="flex items-center gap-2 text-xs">
            <button
              class="h-6 w-6 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center"
              onclick="updateCartQuantity(${ci.id}, -1)"
            >-</button>
            <span>${ci.quantity}</span>
            <button
              class="h-6 w-6 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center"
              onclick="updateCartQuantity(${ci.id}, 1)"
            >+</button>
          </div>
          <div class="text-xs font-semibold text-emerald-300">
            ${formatPrice(lineTotal)}
          </div>
        `;
        list.appendChild(row);
      });

      badge.textContent = `(${itemCount} item${itemCount !== 1 ? "s" : ""})`;
      subtotalEl.textContent = formatPrice(subtotal);
      totalEl.textContent = formatPrice(subtotal); // no extra fees in demo
    }

    async function placeOrder() {
      if (!cart.length) {
        showAlert("Your cart is empty.", "error");
        return;
      }

      const name = document.getElementById("customerName").value.trim();
      const address = document.getElementById("customerAddress").value.trim();
      const phone = document.getElementById("customerPhone").value.trim();
      const notes = document.getElementById("customerNotes").value.trim();
      const btn = document.getElementById("placeOrderBtn");

      if (!name || !address || !phone) {
        showAlert("Please fill name, address and phone.", "error");
        return;
      }

      btn.disabled = true;

      const payload = {
        customer: { name, address, phone, notes },
        items: cart.map(c => ({ id: c.id, quantity: c.quantity })),
      };

      try {
        const res = await fetch("/api/order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json();
        if (!res.ok) {
          showAlert(data.error || "Failed to place order.", "error");
        } else {
          showAlert(`Order ${data.orderId} placed successfully! Total: ${formatPrice(data.total)}`, "success");
          clearCart();
        }
      } catch (err) {
        console.error(err);
        showAlert("Network error while placing order.", "error");
      } finally {
        btn.disabled = false;
      }
    }

    async function fetchMenu() {
      const res = await fetch("/api/menu");
      fullMenu = await res.json();
      filteredMenu = [...fullMenu];
      renderMenu();
    }

    function setupFilters() {
      const pills = document.querySelectorAll(".filter-pill");
      pills.forEach(pill => {
        pill.classList.add(
          "px-3",
          "py-1",
          "rounded-full",
          "bg-slate-900",
          "border",
          "border-slate-700",
          "text-slate-300",
          "cursor-pointer",
          "hover:border-emerald-400",
          "hover:text-emerald-300"
        );
        pill.addEventListener("click", () => {
          pills.forEach(p => p.classList.remove("filter-pill-active", "bg-emerald-500/20", "border-emerald-400"));
          pill.classList.add("filter-pill-active", "bg-emerald-500/20", "border-emerald-400");
          applyFilters();
        });
      });

      // default active "All"
      const firstPill = document.querySelector('.filter-pill[data-category="All"]');
      if (firstPill) firstPill.click();
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchMenu();
      setupFilters();
      document.getElementById("searchInput").addEventListener("input", applyFilters);
      renderCart();
    });
  </script>
</body>
</html>
